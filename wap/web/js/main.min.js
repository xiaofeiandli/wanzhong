!function(){function a(a,c){var d={},e={zh:"请输入验证码",en:"Please enter verification code"};d.loading="<div style='text-align: center;'><img src='/images/loading.gif'></div>",d.code="<div class='modal-content'><div class='verify-content'><h2 class='verify-title'>"+e[b]+"</h2><div class='flex'><div class='form-item'><input class='form-control verify-code' maxlength='6'></div><img class='verify-image' src></div></div></div>",this.$cover=$("<div/>",{"class":"modal-cover"}).appendTo("body"),this.$modal=$("<div/>",{"class":"modals",html:"<div class='modal-dialog'>"+d[a]+"</div>"}).appendTo("body"),"code"==a&&(this.$code=this.$modal.find(".verify-code"),this.$image=this.$modal.find(".verify-image"))}var b=$("#en").get(0)?"en":"zh",c="en"==b?"/en/":"/";"zh"==b&&$("body").attr("id","zh");var d=document.documentElement.clientWidth/10;a.prototype.show=function(){this.$cover.fadeIn(),this.$modal.fadeIn()},a.prototype.hide=function(){this.$cover.fadeOut(),this.$modal.fadeOut()},a.prototype.destroy=function(){this.$cover.remove(),this.$modal.remove()};var e=new a("loading"),f=function(){var a=$("#menu_btn").data("value",!0),b=$("#icon"),c=$("#nav");a.on("click",function(){var a=$(this).data("value");a?(b.show(),c.slideDown()):c.slideUp(function(){b.hide()}),$(this).data("value",!a)}),$(document).on("click",function(d){var e=$(d.target).get(0),f=a.get(0);a.data("value")||e===f||$.contains(f,e)||(a.data("value",!0),c.slideUp(function(){b.hide()}))})},g=function(){function a(a){l&&j&&h&&k&&$.ajax({url:c+"news/ajaxlist/"+l+"/"+j+"/"+h+"/"+k+"/"+4.5333*d,dataType:"JSON",beforeSend:function(){a&&e.show()},success:function(c){if(0==c.code&&200==c.status){if(a)f.append(c.data.data),f.masonry({itemSelector:".news-item",gutter:.3473*d,isAnimated:!0});else{var e=$("<div/>").append(c.data.data);e.find(".news-item").each(function(){var a=$(this);f.append(a).masonry("appended",a)})}i<12*h?g.data("value",!1).text(m[b].none):(g.data("value",!0).text(m[b].normal),h++,k=c.data.last)}else g.data("value",!0).text(c.msg)},error:function(a,b,c){alert(a.status+" "+c)},complete:function(){a&&e.hide()}})}var f=$("#grid"),g=$("#add_more").data("value",!0),h=g.attr("data-page"),i=g.attr("data-total"),j=g.attr("data-id"),k=g.attr("data-last"),l="grid",m={zh:{normal:"加载更多",loading:"加载中...",none:"没有更多了"},en:{normal:"Load for more",loading:"Loading...",none:"End of the page"}};a(!0),$(window).scroll(function(){var c=g.offset().top,d=$(document).scrollTop(),e=$(window).height();g.data("value")&&d+e+50>=c&&(g.data("value",!1).text(m[b].loading),a())})},h=function(a){function b(a){var b=new BMap.Map(a.container);b.enableScrollWheelZoom();var c=new BMap.Geocoder;c.getPoint(a.address,function(a){if(a){b.centerAndZoom(a,14);var c=new BMap.Marker(a);b.addOverlay(c)}},a.city)}var c={container:a,city:"杭州",address:"杭州国际博览中心"};b(c)},i=function(){function d(){var a=$("#card"),b=$("#card_select"),c=$("#card_view");b.change(function(){$(this).val().length<1||$("#card_form").ajaxSubmit({url:"/application/putfile",type:"POST",dataType:"JSON",beforeSend:function(){e.show()},success:function(b){0==b.code?(a.val(b.data),c.html("<i class='remove'></i><img src='"+b.data+"'>")):alert(b.msg)},error:function(a){alert(a.responseText)},complete:function(){e.hide()}})}),c.on("click",function(d){var e=$(d.target).get(0),f=c.find(".remove").get(0);f!=e?b.click():(a.val(""),c.html(""))})}function f(){for(var a=0;a<t[k].length;a++){var b=t[k][a];if("purpose"!=b&&"website"!=b&&"card"!=b){if(!s[b]())return q=!1,!1;r[b]=s[b]()}else r[b]=s[b]()}return q=!0}function g(){for(var a=u[k][b],c="",d=0;d<t[k].length;d++){var e=t[k][d],f=a[d],g="";"certificate_type"!=e&&(g="certificate_number"==e?r.certificate_type+" "+r[e]:"card"==e?r[e]?"<img src='"+r[e]+"'>":"":r[e],c+="<div class='info-item'><label class='info-label'>"+f+"</label><p class='info-detail'>"+g+"</p></div>")}o.find(".apply-info-detail").html(c)}function h(){$("body").animate({scrollTop:0},500)}function i(){$.ajax({url:"/site/captcha?refresh",dataType:"JSON",cache:"false",success:function(a){w.$image.prop("src",a.url)}})}function j(){$.ajax({url:c+"application/doapply",type:"POST",data:r,dataType:"JSON",beforeSend:function(){e.show()},success:function(a){0==a.code?(n.remove(),o.remove(),p.show(),l.text(v.success[b]),"person"===k&&$("#ret_chart").attr("href",a.data.qrcode).html("<img class='ret-chart' src='"+a.data.qrcode+"'>"),h(),window.onbeforeunload=null):alert(a.msg)},error:function(a){console.log(a)},complete:function(){e.hide()}})}var k=$("#apply").attr("data-type"),l=$("#apply_title"),m=l.text(),n=$("#apply_form"),o=$("#apply_info"),p=$("#apply_result"),q=!1,r={type:function(){var a=0;return"media"==k?a=1:"company"==k&&(a=2),a}()};$("#company").find("input").on("blur",function(){Verify.empty("#company","input","company")}),$("#name").find("input").on("blur",function(){Verify.empty("#name","input","name")}),$("#position").find("input").on("blur",function(){Verify.empty("#position","input","position")}),$("#cellphone").find("input").on("blur",function(){Verify.reg("#cellphone","cellphone")}),$("#telephone").find("input").on("blur",function(){Verify.telephone("#telephone")}),$("#email").find("input").on("blur",function(){Verify.reg("#email","email")}),$("#address").find("select").on("blur change",function(){var a=$(this).attr("name");Verify.select("#address",a)}).end().find("input").on("blur",function(){Verify.empty("#address","input","address")}),$("#area").find("select").on("blur change",function(){Verify.select("#area","area")}),$("#classes").find("select").on("blur change",function(){Verify.select("#classes","classes")});var s={company:function(){return Verify.empty("#company","input","company",!0)},media:function(){return Verify.empty("#company","input","company",!0)},name:function(){return Verify.empty("#name","input","name",!0)},certificate_type:function(){return $("#id").find("select").val()},certificate_number:function(){return Verify.reg("#id","id",!0)},position:function(){return Verify.empty("#position","input","position",!0)},cellphone:function(){return Verify.reg("#cellphone","cellphone",!0)},telephone:function(){return Verify.telephone("#telephone",!0)},email:function(){return Verify.reg("#email","email",!0)},address:function(){return!!(Verify.select("#address","province",!0)&&Verify.select("#address","city",!0)&&Verify.empty("#address","input","address",!0))&&Verify.select("#address","province")+" "+Verify.select("#address","city")+" "+Verify.empty("#address","input","address")},area:function(){return Verify.select("#area","area",!0)},classes:function(){return Verify.select("#classes","classes",!0)},purpose:function(){return $("#purpose").find("textarea").val()},website:function(){return $("#website").find("input").val()},card:function(){return $("#card").val()}},t={person:["name","cellphone","certificate_type","certificate_number","email","company","position"],media:["name","cellphone","certificate_type","certificate_number","email","company","position","address","card"],company:["company","name","position","telephone","email","address","website","purpose","area","classes"]},u={person:{zh:["姓名","手机","身份证","证件号码","邮箱地址","公司","职位"],en:["NAME","MOBILE PHONE","ID card","ID NO.","EMAIL","COMPANY","POSITION"]},media:{zh:["姓名","手机","身份证","证件号码","邮箱地址","公司","职位","地址","电子名片"],en:["NAME","MOBILE PHONE","ID card","ID NO.","EMAIL","COMPANY","POSITION","ADDRESS","CARD"]},company:{zh:["公司名称","联系人","职位","联系电话","邮箱地址","公司地址","公司网站","参展目的","参展面积","参展类型"],en:["COMPANY NAME","CONTACT PERSON","POSITION","TELEPHONE NO.","EMAIL","COMPANY ADDRESS","COMPANY WEBSITE","PURPOSE FOR PARTICIPATION","BOOTH AREA","CATEGORY"]}},v={confirm:{zh:"信息确认",en:"CONFORMATION"},success:{zh:"报名成功",en:"REGISTRATION COMPLETED"}};"media"==k&&d(),n.find(".submit").on("click",function(){f()&&(l.text(v.confirm[b]),n.hide(),o.show(),g(),h())}),o.find(".back").on("click",function(){l.text(m),n.show(),o.hide(),h()});var w=new a("code");i(),w.$image.on("click",function(){i()}),w.$code.on("keyup",function(){w.$code.removeClass("error"),6==this.value.length&&$.ajax({url:"/application/validatecode",type:"POST",data:"captcha="+this.value,success:function(a){0==a.code?q&&(w.hide(),j()):w.$code.addClass("error")}})}),o.find(".submit").on("click",function(){w.show()}),window.onbeforeunload=function(a){return(a||window.event).returnValue="确定要离开?"}};$(document).ready(function(){f(),$("#grid").get(0)&&g(),$("#map").get(0)&&h("map"),$("#apply").get(0)&&i()})}(jQuery);